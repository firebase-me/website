<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0,maximum-scale=1.0, user-scalable=no"">
    <title>Navbar with Header and Sidebars</title>

    
    <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@400;700&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/styles/dracula.min.css">
    <link href="
        https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Open+Sans:wght@400;700&display=swap"
        rel="stylesheet">

    <link id="main-styles" rel="stylesheet" href="/assets/css/main.css">
    <link id="header-styles" rel="stylesheet" href="/assets/css/header.css">
    <link id="navbar-styles" rel="stylesheet" href="/assets/css/navbar.css">
    <link id="mobile-styles" rel="stylesheet" href="/assets/css/mobile.css">
    <link id="theme-link" rel="stylesheet" href="/assets/css/default.css">

    <style>

    </style>
</head>

<body>
    <div class="header">
        <div class="header-buttons" id="header-buttons">
            <!-- Header buttons will be generated here -->
        </div>
        <button class="toggle-nav" onclick="toggleNav()">â˜° Menu</button>
    </div>
    <div class="container">
        <div class="sidebar" id="sidebar">
            <div class="crumbs" id="crumbtray">
                <!-- crumb items for sidebar will be generated here -->
            </div>
            <div class="navbar" id="navbar">
                <!-- navbar content will be generated by JavaScript -->
            </div>
            <button class="theme-button" onclick="showThemeDialog()">Theme</button>
            <button class="toggle-nav" onclick="toggleNav()">Close X</button>
        </div>

        <main id="content">
            <h2 id="document-title" style="margin-bottom: 0px;"></h2>
            <div class="content-body" id="markdown-content">
                <!-- Markdown content will be loaded here -->
            </div>
        </main>
    </div>
    <!-- Theme selection dialog -->
    <div id="theme-dialog" class="theme-dialog">
        <div class="theme-dialog-content">
            <span class="close" onclick="closeThemeDialog()">&times;</span>
            <h2>Select Theme</h2>
            <div id="theme-list" class="theme-list">
                <!-- Theme buttons will be generated here -->
            </div>
        </div>
    </div>

    <script>
        let jsonData;
        const approvedFiles = ['md'];

        // Function to generate the header buttons from root items in JSON
        function generateHeaderButtons(data) {
            const headerButtons = document.getElementById('header-buttons');
            headerButtons.innerHTML = ''; // Clear existing buttons
            data.forEach((item, index) => {
                const button = document.createElement('button');
                button.textContent = item.name;
                button.addEventListener('click', () => {
                    switchNavContent(index);
                });
                headerButtons.appendChild(button);
            });
        }

        // Function to switch the content in the navbar based on the selected header tab
        function switchNavContent(index) {
            const selectedData = jsonData[index].children;
            const navbar = document.getElementById('navbar');
            navbar.innerHTML = '';
            generateNavbar(selectedData, navbar);
        }

        // Function to generate the navbar HTML based on JSON data
        function generateNavbar(data, parentElement, depth = 0) {
            data.forEach(item => {
                if (item.type === "category" || item.type === "dir") {
                    const btn = document.createElement("button");
                    btn.className = `dropdown-btn ${item.children.length ? 'has-children' : 'no-children'}`;
                    btn.textContent = sanitizeName(item.name);
                    btn.style.paddingLeft = `${16 + depth * 12}px`;

                    if (item.children.length) {
                        btn.addEventListener("click", function () {
                            this.classList.toggle("open");
                            const dropdownContent = this.nextElementSibling;
                            if (dropdownContent) {
                                dropdownContent.style.display = dropdownContent.style.display === "block" ? "none" : "block";
                            }
                        });

                        const dropdownContainer = document.createElement("div");
                        dropdownContainer.className = "dropdown-container";
                        parentElement.appendChild(btn);
                        parentElement.appendChild(dropdownContainer);
                        generateNavbar(item.children, dropdownContainer, depth + 1);
                    } else {
                        parentElement.appendChild(btn);
                    }
                } else if (item.type === "file") {
                    const fileExtension = item.name.split('.').pop();
                    if (approvedFiles.includes(fileExtension)) {
                        const link = document.createElement("a");
                        link.textContent = sanitizeName(item.name);
                        link.className = 'file-link';
                        link.style.paddingLeft = `${16 + depth * 12}px`;
                        link.addEventListener("click", function () {
                            console.log(item.path);
                            generateRandomCrumbs();
                            const allLinks = document.querySelectorAll('.navbar a, .navbar button');
                            allLinks.forEach(link => link.classList.remove('selected', 'selected-file'));
                            this.classList.add('selected', 'selected-file');
                            let parent = this.parentElement;
                            while (parent && parent.classList.contains('dropdown-container')) {
                                const siblingButton = parent.previousElementSibling;
                                if (siblingButton) {
                                    siblingButton.classList.add('selected');
                                }
                                parent = parent.parentElement;
                            }
                        });
                        parentElement.appendChild(link);
                    }
                }
            });
        }

        function sanitizeName(input) {
            const baseName = input.replace(/\.(md)$/i, '');
            // const baseName = input.replace(/\.(html|md|js|yaml|yml|json)$/i, '');
            const withSpaces = baseName.replace(/[_-]/g, ' ');

            // List of filler words to exclude from capitalization
            const fillerWords = ['in', 'of', 'the', 'and', 'a', 'to', 'for', 'with'];

            const words = withSpaces.split(' ');
            const formattedWords = words.map((word, index) => {
                if (index === 0 || !fillerWords.includes(word.toLowerCase())) {
                    return word.charAt(0).toUpperCase() + word.slice(1).toLowerCase();
                }
                return word.toLowerCase();
            });
            return formattedWords.join(' ');
        }

        // Function to generate random crumbs for crumbtray
        function generateRandomCrumbs() {
            const crumbs = document.getElementById('crumbtray');
            crumbs.innerHTML = ''; // Clear existing items
            const itemCount = Math.floor(Math.random() * 11); // Random number of items between 0 and 10
            if (itemCount > 0) {
                crumbs.classList.add('has-content');
            } else {
                crumbs.classList.remove('has-content');
            }
            for (let i = 0; i < itemCount; i++) {
                const button = document.createElement('button');
                button.textContent = `Anchor ${i + 1}`;
                button.addEventListener('click', () => highlightActiveCrumb(button));
                crumbs.appendChild(button);
            }
        }

        // Toggle the visibility of the sidebar on mobile
        function toggleNav() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('active');
        }

        // Handle active crumb highlighting
        function highlightActiveCrumb(button) {
            const allCrumbs = document.querySelectorAll('.crumbs button');
            allCrumbs.forEach(crumb => crumb.classList.remove('active'));
            button.classList.add('active');
        }

        // Fetch the JSON data and initialize the navbar and header
        fetch('/structure.json')
            .then(response => response.json())
            .then(data => {
                jsonData = data;
                generateHeaderButtons(data);
                switchNavContent(0); // Display the first tab's content by default
            })
            .catch(error => console.error('Error loading JSON:', error));

        // Function to show the theme dialog
        function showThemeDialog() {
            document.getElementById('theme-dialog').style.display = 'block';
            loadThemes();
        }
        function changeTheme(asset) {
            const themeLink = document.getElementById('theme-link');
            themeLink.href = asset;
            closeThemeDialog();
        }
        // Function to close the theme dialog
        function closeThemeDialog() {
            document.getElementById('theme-dialog').style.display = 'none';
        }

        function loadThemes() {
            fetch('/themes.json')
                .then(response => response.json())
                .then(data => {
                    const themeList = document.getElementById('theme-list');
                    themeList.innerHTML = ''; // Clear existing themes
                    data.forEach(theme => {
                        const button = document.createElement('button');
                        button.textContent = `${theme.name} by ${theme.creator}`;
                        button.onclick = () => changeTheme(theme.asset);
                        themeList.appendChild(button);
                    });
                })
                .catch(error => console.error('Error loading themes:', error));
        }
    </script>
</body>

</html>